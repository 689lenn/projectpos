{% extends "base.html" %}
{% block title %}Daftar Kategori{% endblock %}

{% block head %}
<style>
  :root{
    --card-bg:#fff;
    --border:#e6e8f0;
    --text:#111827;
    --muted:#6b7280;
    --brand:#007bff;
    --brand-hover:#0064cf;
    --danger:#dc3545;
    --danger-hover:#bb2d3b;
    --ring: rgba(0,123,255,.25);
    --radius: 12px;
    --shadow: 0 10px 25px rgba(0,0,0,.06);
    --shadow-sm: 0 6px 16px rgba(0,0,0,.05);
  }

  .page-title{
    margin: 0 0 6px;
    text-align:center;
    letter-spacing:.2px;
  }
  .subnote{
    text-align:center;
    margin-bottom: 14px;
    color:var(--muted);
    font-size: 13px;
  }

  /* Toolbar */
  .toolbar{
    display:flex; gap:10px; flex-wrap:wrap;
    align-items:center; justify-content:space-between;
    margin-bottom: 12px;
  }
  .toolbar-left{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; }
  .search{
    position:relative;
  }
  .search input{
    width: 260px; max-width: 80vw;
    padding:10px 12px 10px 36px;
    border:1px solid var(--border); border-radius: 999px;
    outline:none; transition: box-shadow .15s ease, border-color .15s ease;
    background:#fff;
  }
  .search input:focus{ border-color:#cfe3ff; box-shadow:0 0 0 4px var(--ring); }
  .search .icon{
    position:absolute; left:10px; top:50%; transform:translateY(-50%);
    color:#9aa1a9; font-size:14px;
  }

  .toolbar-right a.btn{
    background:var(--brand); color:#fff; padding:10px 12px; border-radius: 10px; text-decoration:none;
    font-weight:700;
  }
  .toolbar-right a.btn:hover{ background:var(--brand-hover); }

  /* Tabel modern (desktop) */
  .table-wrap{ overflow-x:auto; border-radius: 10px; }
  .table-modern{
    width:100%; border-collapse:collapse; background:#fff;
    border-radius:10px; overflow:hidden; border: 1px solid var(--border);
    box-shadow: var(--shadow-sm);
  }
  .table-modern thead th{
    background:#f8fafc; color:#334155;
    font-weight:700; padding:12px; text-align:left;
    border-bottom: 1px solid #e9eef5;
  }
  .table-modern tbody td{
    padding:12px; border-bottom:1px solid #f0f3f7;
  }
  .td-actions{ text-align:center; white-space:nowrap; }
  .text-right{ text-align:right; }

  .pname{ font-weight:700; color:var(--text); }
  .muted{ color:var(--muted); font-size:12px; }

  .btn-sm{
    display:inline-flex; align-items:center; justify-content:center;
    padding:8px 10px; border-radius:8px; border:none; cursor:pointer;
    font-weight:700; color:#ffffff; 
    box-shadow: 0 2px 5px rgba(0,0,0,0.08);
  }
  .btn-edit{ background:var(--brand); }
  .btn-edit:hover{ background:var(--brand-hover); }
  .btn-del{ background:var(--danger); }
  .btn-del:hover{ background:var(--danger-hover); }

  /* Kartu (mobile) */
  .cards{ display:none; flex-direction:column; gap:10px; }
  .card{
    background:#fff; border:1px solid var(--border); border-radius:10px;
    padding:12px; display:flex; gap:12px; align-items:flex-start; justify-content:space-between;
    box-shadow: var(--shadow-sm);
  }
  .card .info{ flex:1; min-width:0; }
  .card .row1{ display:flex; align-items:center; gap:10px; margin-bottom:4px; }
  .card .row2{ display:flex; align-items:center; gap:12px; flex-wrap:wrap; color:#334155; font-size:13px; }
  .chip{
    display:inline-flex; gap:6px; align-items:center;
    background:#f3f4f6; border:1px solid #eceff3; border-radius:999px; padding:4px 10px;
  }
  .cta{ display:flex; gap:8px; }
  .cta form{ display:inline; }

  .empty{
    text-align:center; color:#6b7280;
    background:#fff; border:1px dashed #dfe3ea; padding:18px; border-radius:12px;
  }

  @media (max-width: 720px){
    .table-wrap{ display:none; }
    .cards{ display:flex; }
    .toolbar-right a.btn{ padding:9px 12px; }
  }
</style>
{% endblock %}

{% block content %}
<h1 class="page-title">Daftar Kategori</h1>
<p class="subnote">Kelola kategori produk: tambah, ubah, atau hapus. Gunakan pencarian untuk menemukan kategori lebih cepat.</p>

<div class="toolbar">
  <div class="toolbar-left">
    <div class="search">
      <span class="icon">ðŸ”Ž</span>
      <input type="text" id="q" placeholder="Cari nama kategori..." aria-label="Cari kategori" oninput="filterCats()">
    </div>
  </div>
  <div class="toolbar-right">
    <a href="{{ url_for('kategori_tambah') }}" class="btn">+ Tambah Kategori</a>
  </div>
</div>

{% if daftar %}
  <!-- Tabel (desktop) -->
  <div class="table-wrap">
    <table class="table-modern" id="tableKategori">
      <thead>
        <tr>
          <th>Nama Kategori</th>
          <th class="text-right">Jumlah Produk</th>
          <th class="td-actions">Aksi</th>
        </tr>
      </thead>
      <tbody>
        {% for k in daftar %}
        <tr data-name="{{ k.nama|lower }}">
          <td>
            <div class="pname">{{ k.nama }}</div>
            <div class="muted">ID: {{ k.id }}</div>
          </td>
          <td class="text-right">{{ k.produk|length }}</td>
          <td class="td-actions">
            <a href="{{ url_for('kategori_edit', id=k.id) }}" class="btn-sm btn-edit">ðŸ–Š Edit</a>
            <form action="{{ url_for('kategori_hapus', id=k.id) }}" method="post" style="display:inline;" onsubmit="return confirm('Yakin hapus kategori ini?')">
              <button type="submit" class="btn-sm btn-del">ðŸ—‘ Hapus</button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Cards (mobile) -->
  <div class="cards" id="cardsKategori">
    {% for k in daftar %}
    <div class="card" data-name="{{ k.nama|lower }}">
      <div class="info">
        <div class="row1">
          <div class="pname">{{ k.nama }}</div>
        </div>
        <div class="row2">
          <span class="chip">Jumlah produk: <strong>{{ k.produk|length }}</strong></span>
          <span class="muted">ID: {{ k.id }}</span>
        </div>
      </div>

      <div class="cta">
        <a href="{{ url_for('kategori_edit', id=k.id) }}" class="btn-sm btn-edit">ðŸ–Š</a>
        <form action="{{ url_for('kategori_hapus', id=k.id) }}" method="post" onsubmit="return confirm('Yakin hapus kategori ini?')">
          <button type="submit" class="btn-sm btn-del">ðŸ—‘</button>
        </form>
      </div>
    </div>
    {% endfor %}
  </div>
{% else %}
  <div class="empty">Belum ada kategori. Klik <strong>+ Tambah Kategori</strong> untuk menambahkan.</div>
{% endif %}

<script>
  function filterCats(){
    const q = (document.getElementById('q').value || '').toLowerCase().trim();

    // Tabel
    const rows = document.querySelectorAll('#tableKategori tbody tr');
    rows.forEach(tr => {
      const name = (tr.getAttribute('data-name') || '');
      tr.style.display = (!q || name.includes(q)) ? '' : 'none';
    });

    // Cards
    const cards = document.querySelectorAll('#cardsKategori .card');
    cards.forEach(card => {
      const name = (card.getAttribute('data-name') || '');
      card.style.display = (!q || name.includes(q)) ? 'flex' : 'none';
    });
  }
</script>
{% endblock %}